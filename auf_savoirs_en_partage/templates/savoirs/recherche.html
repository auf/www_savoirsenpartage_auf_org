{% extends "container_base.html" %}

{% block contenu %}
<script>
  $(document).ready(function(){
    makePageLinks ({{ page|default:0 }}, {{ data.last_page|default:0 }}, 
                   '{{ data.more_link }}');
  });

  {% if user.is_authenticated %}
  function showEditModal (uri) {
    $('#jsonsource').load ('{% url savoirs.views.json_get %}?uri='+uri, 
    function() {
      __jf = new JSONForm ('schema', 'mainform', 'jsonsource');
      __jf.setup ();
      $('#edit-form').dialog({height: 400, width: 650, modal: true});
    });
  }
  {% endif %}
</script>
<div class="texte">
    <h4>Résultats correspondant à « {{ q }} »</h4>
    
{% if ressources %}
    <h5>Ressources ({{ ressources|length }} sur {{ total_ressources }})</h5>
    {% for ressource in ressources %}
        {% include "savoirs/ressource_resultat.html" %} 
    {% endfor %}
    {% ifnotequal ressources|length total_ressources %}
        <p class="pad"><a href="{% url savoirs.views.ressource_index %}?q={{ q|urlencode }}">Toutes les {{ total_ressources }} ressources pour cette recherche</a></p>
    {% endifnotequal %}
{% endif %}

{% if actualites %}
    <h5>Actualités ({{ actualites|length }} sur {{ total_actualites }})</h5>
    {% for actualite in actualites %}
        {% include "savoirs/actualite_resultat.html" %} 
    {% endfor %}
    {% ifnotequal actualites|length total_actualites %}
        <p class="pad"><a href="{% url savoirs.views.actualite_index %}?q={{ q|urlencode }}">Toutes les {{ total_actualites }} actualités pour cette recherche</a></p>
    {% endifnotequal %}
{% endif %}

{% if evenements %}
    <h5>Événements ({{ evenements|length }} sur {{ total_evenements }})</h5>
    {% for evenement in evenements %}
        {% include "savoirs/evenement_resultat.html" %}
    {% endfor %}
    {% ifnotequal evenements|length total_evenements %}
        <p class="pad"><a href="{% url savoirs.views.evenement_index %}?q={{ q|urlencode }}">Tous les {{ total_evenements }} événements pour cette recherche</a></p>
    {% endifnotequal %}
{% endif %}

{% if chercheurs %}
    <h5>Chercheurs ({{ chercheurs|length }} sur {{ total_chercheurs }})</h5>
    <ul>
    {% for chercheur in chercheurs %}
        <li><a href="{% url chercheurs.views.retrieve chercheur.id %}">{{ chercheur }}</a></li>
    {% endfor %}
    </ul>
    {% ifnotequal chercheurs|length total_chercheurs %}
        <p class="pad"><a href="{% url chercheurs.views.index %}?mots_cles={{ q|urlencode }}">Tous les {{ total_chercheurs }} chercheurs pour cette recherche</a></p>
    {% endifnotequal %}
{% endif %}

{% if sites %}
    <h5>Sites ({{ sites|length }} sur {{ total_sites }})</h5>
    {% for site in sites %}
        {% include "sites/resultat.html" %}
    {% endfor %}
    {% ifnotequal sites|length total_sites %}
        <p class="pad"><a href="{% url sitotheque.views.index %}?mots_cles={{ q|urlencode }}">Tous les {{ total_sites }} sites pour cette recherche</a></p>
    {% endifnotequal %}
{% endif %}

{% if not ressources and not actualites and not evenements and not chercheurs and not sites %}
    <h5>Aucune résultat</h5>
    <p class="pad"><a href="{% url savoirs.views.index %}">Retour à la page d'accueil</a></p>
{% endif %}
</div>

{% if user.is_authenticated %}
    {% include "savoirs/editor.html" %}
{% endif %}

{% endblock %}
